<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FPS Test</title>
  <style>
    body { margin: 0; overflow: hidden; background: #222; }

    #overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.7);
      color: white;
      font-size: 24px;
      z-index: 10;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="overlay">Click to start</div>

<script type="module">
  import * as THREE from "https://unpkg.com/three@0.161.0/build/three.module.js";
  import { PointerLockControls } from "https://unpkg.com/three@0.161.0/examples/jsm/controls/PointerLockControls.js";

  console.log("THREE loaded!");

  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x444444);

  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.set(0, 1.8, 5);

  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Lighting
  scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1));

  // Floor
  const floor = new THREE.Mesh(
    new THREE.PlaneGeometry(50, 50),
    new THREE.MeshStandardMaterial({ color: 0x333333 })
  );
  floor.rotation.x = -Math.PI / 2;
  scene.add(floor);

  // Cube NPC
  const cube = new THREE.Mesh(
    new THREE.BoxGeometry(1, 2, 1),
    new THREE.MeshStandardMaterial({ color: 0x2196f3 })
  );
  cube.position.set(0, 1, -5);
  scene.add(cube);

  // Controls
  const controls = new PointerLockControls(camera, document.body);

  const overlay = document.getElementById("overlay");
  overlay.addEventListener("click", () => controls.lock());

  controls.addEventListener("lock", () => {
    overlay.style.display = "none";
  });
  controls.addEventListener("unlock", () => {
    overlay.style.display = "flex";
  });

  // Movement keys
  const keys = { KeyW:false, KeyA:false, KeyS:false, KeyD:false };
  document.addEventListener("keydown", e => { if (keys[e.code] !== undefined) keys[e.code] = true; });
  document.addEventListener("keyup", e => { if (keys[e.code] !== undefined) keys[e.code] = false; });

  // Movement physics-ish
  let prevTime = performance.now();
  const velocity = new THREE.Vector3();
  const direction = new THREE.Vector3();

  function updateMovement() {
    if (!controls.isLocked) return;

    const time = performance.now();
    const delta = (time - prevTime) / 1000;
    prevTime = time;

    velocity.x -= velocity.x * 10.0 * delta;
    velocity.z -= velocity.z * 10.0 * delta;

    direction.z = Number(keys.KeyS) - Number(keys.KeyW);
    direction.x = Number(keys.KeyD) - Number(keys.KeyA);
    direction.normalize();

    const speed = 5;

    if (keys.KeyW || keys.KeyS) velocity.z -= direction.z * speed * delta;
    if (keys.KeyA || keys.KeyD) velocity.x -= direction.x * speed * delta;

    controls.moveRight(-velocity.x * delta);
    controls.moveForward(-velocity.z * delta);

    // Keep camera at normal height
    camera.position.y = 1.8;
  }

  function animate() {
    requestAnimationFrame(animate);
    updateMovement();
    cube.rotation.y += 0.01;
    renderer.render(scene, camera);
  }
  animate();

  window.addEventListener("resize", () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>

</body>
</html>
